
import os,subprocess
targetIndex = 19
src_name = "example.cu"

flagHeader = "CICC_MODIFY_OPT_MODULE=1 LD_PRELOAD=./libnvcc.so nvcc -arch=sm_30 -rdc=true -dc -g -G -Xptxas -O0 -D BAMBOO_PROFILING"
ktraceFlag = " -D KERNELTRACE"
makeCommand1 = "STUPLE_FILE=results/simplified_inst_tuples.txt " + "S_INDEX=" + str(targetIndex) + " " + flagHeader + " " + src_name + " -o temp.o" + ktraceFlag

file_list = os.listdir("libs/sim/lib")

os.system("cp libs/sim/lib/* .")

print makeCommand1

#exit()
p = subprocess.check_output(makeCommand1, shell=True)
simOutput = p.stdout.read()

print simOutput

# Clean the copied files
for file in file_list:
    os.remove(file)

